insmod part_msdos
insmod ext2
set root='hd0,msdos1'
set prefix="($root)/boot/grub"
set timeout=60

if [ -f $prefix/themes/active/theme.txt ]
then
	. $prefix/themes/active/theme.cfg
	set gfxmode=1024x768x32
	insmod all_video
	insmod gfxterm
	set locale_dir=$prefix/locale
	set lang=en_US
	insmod gettext
	terminal_output gfxterm
	insmod gfxmenu
	insmod png
	set theme=$prefix/themes/active/theme.txt
	set gfxpayload=keep
fi

menuentry 'GNU' --class hurd --class gnu --class os {
	echo 'Loading GNU Mach from hd0s1 ...'
	multiboot /boot/gnumach root=device:hd0s1

	echo 'Loading initial GNU Hurd servers ...'
	module /hurd/ext2fs.static ext2fs \
		--device-master-port='${device-port}' \
		--exec-server-task='${exec-task}' \
		--host-priv-port='${host-port}' \
		--multiboot-command-line='${kernel-command-line}' \
		-T typed \
		'${root}' '$(task-create)' '$(task-resume)'
	module /lib/ld.so exec \
		/hurd/exec '$(exec-task=task-create)'
}

menuentry 'GNU - Single User Mode' --class hurd --class gnu --class os {
	echo 'Loading GNU Mach from hd0s1 ...'
	multiboot /boot/gnumach root=device:hd0s1 -s

	echo 'Loading initial GNU Hurd servers ...'
	module /hurd/ext2fs.static ext2fs \
		--device-master-port='${device-port}' \
		--exec-server-task='${exec-task}' \
		--host-priv-port='${host-port}' \
		--multiboot-command-line='${kernel-command-line}' \
		-T typed \
		'${root}' '$(task-create)' '$(task-resume)'
	module /lib/ld.so exec \
		/hurd/exec '$(exec-task=task-create)'
}

menuentry 'GNU - Read Only Mode' --class hurd --class gnu --class os {
	echo 'Loading GNU Mach from hd0s1 ...'
	multiboot /boot/gnumach root=device:hd0s1

	echo 'Loading initial GNU Hurd servers ...'
	module /hurd/ext2fs.static ext2fs \
		--device-master-port='${device-port}' \
		--exec-server-task='${exec-task}' \
		--host-priv-port='${host-port}' \
		--multiboot-command-line='${kernel-command-line}' \
		--readonly \
		-T typed \
		'${root}' '$(task-create)' '$(task-resume)'
	module /lib/ld.so exec \
		/hurd/exec '$(exec-task=task-create)'
}
